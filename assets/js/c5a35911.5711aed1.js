"use strict";(self.webpackChunkcosmos_hub_docs_site=self.webpackChunkcosmos_hub_docs_site||[]).push([[5967],{6016:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ledger_2-0fe258512b66899f1a60ffb8986ebb48.jpg"},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var t=i(6540);const r={},a=t.createContext(r);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(a.Provider,{value:n},e.children)}},9631:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/ledger_1-333b5a02b13138ef329933950ec162af.jpg"},9666:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"validators/kms/kms_ledger","title":"Setting up Tendermint KMS + Ledger","description":"The following instructions are a brief walkthrough and not a comprehensive guideline. You should consider and research more about the security implications of activating an external KMS.","source":"@site/docs/validators/kms/kms_ledger.md","sourceDirName":"validators/kms","slug":"/validators/kms/kms_ledger","permalink":"/main/validators/kms/kms_ledger","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Setting up Tendermint KMS + Ledger","order":6},"sidebar":"tutorialSidebar","previous":{"title":"KMS - Key Management System","permalink":"/main/validators/kms/"},"next":{"title":"Validator Overview","permalink":"/main/validators/overview"}}');var r=i(2467),a=i(8453);const s={title:"Setting up Tendermint KMS + Ledger",order:6},o=void 0,d={},l=[{value:"Tendermint Validator app (for Ledger devices)",id:"tendermint-validator-app-for-ledger-devices",level:2},{value:"KMS configuration",id:"kms-configuration",level:2},{value:"Config file",id:"config-file",level:3},{value:"Generate secret key",id:"generate-secret-key",level:3},{value:"Retrieve validator key",id:"retrieve-validator-key",level:3},{value:"Gaia configuration",id:"gaia-configuration",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["The following instructions are a brief walkthrough and not a comprehensive guideline. You should consider and ",(0,r.jsx)(n.a,{href:"/main/validators/security",children:"research more about the security implications"})," of activating an external KMS."]})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"KMS and Ledger Tendermint app are currently work in progress. Details may vary. Use with care under your own risk."})}),"\n",(0,r.jsx)(n.h2,{id:"tendermint-validator-app-for-ledger-devices",children:"Tendermint Validator app (for Ledger devices)"}),"\n",(0,r.jsx)(n.p,{children:"You should be able to find the Tendermint app in Ledger Live."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Note: at the moment, you might need to enable ",(0,r.jsx)(n.code,{children:"developer mode"})," in Ledger Live settings"]})}),"\n",(0,r.jsx)(n.h2,{id:"kms-configuration",children:"KMS configuration"}),"\n",(0,r.jsx)(n.p,{children:"In this section, we will configure a KMS to use a Ledger device running the Tendermint Validator App."}),"\n",(0,r.jsx)(n.h3,{id:"config-file",children:"Config file"}),"\n",(0,r.jsxs)(n.p,{children:["You can find other configuration examples ",(0,r.jsx)(n.a,{href:"https://github.com/iqlusioninc/tmkms/blob/master/tmkms.toml.example",children:"here"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Create a ",(0,r.jsx)(n.code,{children:"~/.tmkms/tmkms.toml"})," file with the following content (use an adequate ",(0,r.jsx)(n.code,{children:"chain_id"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'# Example KMS configuration file\n[[validator]]\naddr = "tcp://localhost:26658"    # or "unix:///path/to/socket"\nchain_id = "gaia-11001"\nreconnect = true # true is the default\nsecret_key = "~/.tmkms/secret_connection.key"\n\n[[providers.ledgertm]]\nchain_ids = ["gaia-11001"]\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Edit ",(0,r.jsx)(n.code,{children:"addr"})," to point to your ",(0,r.jsx)(n.code,{children:"gaiad"})," instance."]}),"\n",(0,r.jsxs)(n.li,{children:["Adjust ",(0,r.jsx)(n.code,{children:"chain-id"})," to match your ",(0,r.jsx)(n.code,{children:".gaia/config/config.toml"})," settings."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"provider.ledgertm"})," has no additional parameters at the moment, however, it is important that you keep that header to enable the feature."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"Plug your Ledger device and open the Tendermint validator app."})}),"\n",(0,r.jsx)(n.h3,{id:"generate-secret-key",children:"Generate secret key"}),"\n",(0,r.jsx)(n.p,{children:"Now you need to generate secret_key:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tmkms keygen ~/.tmkms/secret_connection.key\n"})}),"\n",(0,r.jsx)(n.h3,{id:"retrieve-validator-key",children:"Retrieve validator key"}),"\n",(0,r.jsxs)(n.p,{children:["The last step is to retrieve the validator key that you will use in ",(0,r.jsx)(n.code,{children:"gaiad"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Start the KMS:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"tmkms start -c ~/.tmkms/tmkms.toml\n"})}),"\n",(0,r.jsx)(n.p,{children:"The output should look similar to:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"07:28:24 [INFO] tmkms 0.3.0 starting up...\n07:28:24 [INFO] [keyring:ledgertm:ledgertm] added validator key cosmosvalconspub1zcjduepqy53m39prgp9dz3nz96kaav3el5e0th8ltwcf8cpavqdvpxgr5slsd6wz6f\n07:28:24 [INFO] KMS node ID: 1BC12314E2E1C29015B66017A397F170C6ECDE4A\n"})}),"\n",(0,r.jsx)(n.p,{children:"The KMS may complain that it cannot connect to gaiad. That is fine, we will fix it in the next section."}),"\n",(0,r.jsxs)(n.p,{children:["This output indicates the validator key linked to this particular device is: ",(0,r.jsx)(n.code,{children:"cosmosvalconspub1zcjduepqy53m39prgp9dz3nz96kaav3el5e0th8ltwcf8cpavqdvpxgr5slsd6wz6f"})]}),"\n",(0,r.jsxs)(n.p,{children:["Take note of the validator pubkey that appears in your screen. ",(0,r.jsx)(n.em,{children:"We will use it in the next section."})]}),"\n",(0,r.jsx)(n.h2,{id:"gaia-configuration",children:"Gaia configuration"}),"\n",(0,r.jsxs)(n.p,{children:["You need to enable KMS access by editing ",(0,r.jsx)(n.code,{children:".gaia/config/config.toml"}),". In this file, modify ",(0,r.jsx)(n.code,{children:"priv_validator_laddr"})," to create a listening address/port or a unix socket in ",(0,r.jsx)(n.code,{children:"gaiad"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'...\n# TCP or UNIX socket address for Tendermint to listen on for\n# connections from an external PrivValidator process\npriv_validator_laddr = "tcp://127.0.0.1:26658"\n...\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Let's assume that you have set up your validator account and called it ",(0,r.jsx)(n.code,{children:"kmsval"}),". You can tell gaiad the key that we've got in the previous section."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"gaiad gentx --name kmsval --pubkey {.ValidatorKey} \n"})}),"\n",(0,r.jsxs)(n.p,{children:["Now start ",(0,r.jsx)(n.code,{children:"gaiad"}),". You should see that the KMS connects and receives a signature request."]}),"\n",(0,r.jsx)(n.p,{children:"Once the ledger receives the first message, it will ask for confirmation that the values are adequate."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(9631).A+"",width:"300",height:"150"})}),"\n",(0,r.jsx)(n.p,{children:"Click the right button, if the height and round are correct."}),"\n",(0,r.jsx)(n.p,{children:"After that, you will see that the KMS will start forwarding all signature requests to the ledger:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:i(6016).A+"",width:"313",height:"150"})}),"\n",(0,r.jsxs)(n.admonition,{type:"warning",children:[(0,r.jsx)(n.p,{children:"The word TEST in the second picture, second line appears because they were taken on a pre-release version."}),(0,r.jsx)(n.p,{children:"Once the app as been released in Ledger's app store, this word should NOT appear."})]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);